<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/docker/prod/Dockerfile.front">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/docker/prod/Dockerfile.front" />
              <option name="originalContent" value="# Stage 1: Build&#10;FROM node:18-alpine as builder&#10;&#10;WORKDIR /app&#10;&#10;# Copie package.json et package-lock.json&#10;COPY front/package*.json ./&#10;&#10;# Installation des dépendances&#10;RUN npm ci&#10;&#10;# Copie du code source&#10;COPY front/ ./&#10;&#10;# Build de production&#10;RUN npm run build&#10;&#10;# Stage 2: Production&#10;FROM node:18-alpine&#10;&#10;WORKDIR /app&#10;&#10;# Installation des dépendances de production&#10;COPY front/package*.json ./&#10;RUN npm ci --omit=dev&#10;&#10;# Copie des fichiers de build&#10;COPY --from=builder /app/dist ./dist&#10;&#10;# Copie du serveur&#10;COPY front/server.cjs ./&#10;&#10;EXPOSE 80&#10;&#10;CMD [&quot;node&quot;, &quot;server.cjs&quot;]&#10;" />
              <option name="updatedContent" value="# Stage 1: Build&#10;FROM node:18-alpine as builder&#10;&#10;WORKDIR /app&#10;&#10;# Permet d'injecter l'URL du scraper au build Vite&#10;ARG VITE_SCRAPER_API_URL&#10;ENV VITE_SCRAPER_API_URL=${VITE_SCRAPER_API_URL}&#10;&#10;# Copie package.json et package-lock.json&#10;COPY front/package*.json ./&#10;&#10;# Installation des dépendances&#10;RUN npm ci&#10;&#10;# Copie du code source&#10;COPY front/ ./&#10;&#10;# Build de production&#10;RUN npm run build&#10;&#10;# Stage 2: Production&#10;FROM node:18-alpine&#10;&#10;WORKDIR /app&#10;&#10;# Expose aussi la variable au runtime (utile pour logs/server)&#10;ARG VITE_SCRAPER_API_URL&#10;ENV VITE_SCRAPER_API_URL=${VITE_SCRAPER_API_URL}&#10;&#10;# Installation des dépendances de production&#10;COPY front/package*.json ./&#10;RUN npm ci --omit=dev&#10;&#10;# Copie des fichiers de build&#10;COPY --from=builder /app/dist ./dist&#10;&#10;# Copie du serveur&#10;COPY front/server.cjs ./&#10;&#10;EXPOSE 80&#10;&#10;CMD [&quot;node&quot;, &quot;server.cjs&quot;]" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/scraper/scrapers/titaniumstrength.js">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/scraper/scrapers/titaniumstrength.js" />
              <option name="originalContent" value="/**&#10; * Scraper spécifique pour Titanium Strength&#10; * Site: https://www.titaniumstrength.fr&#10; *&#10; * NOTE: Ce site bloque Playwright/Puppeteer, on utilise donc axios + cheerio&#10; */&#10;&#10;import { gotScraping } from 'got-scraping';&#10;import * as cheerio from 'cheerio';&#10;&#10;// --- Fonctions Utilitaires ---&#10;&#10;/**&#10; * Parse une chaîne de prix simple (ex: &quot;2355&quot; ou &quot;1 535,00€&quot;) en nombre.&#10; */&#10;function parsePriceString(s) {&#10;    if (!s &amp;&amp; s !== 0) return 0;&#10;    let str = String(s).trim();&#10;    if (!str) return 0;&#10;    // enlever espaces insécables et espaces fins&#10;    str = str.replace(/\u00A0|\u202F|\s/g, '');&#10;    // ne garder que chiffres, points, virgules et signe -&#10;    str = str.replace(/[^0-9.,-]/g, '');&#10;    if (!str) return 0;&#10;    const hasComma = str.indexOf(',') !== -1;&#10;    const hasDot = str.indexOf('.') !== -1;&#10;    if (hasComma &amp;&amp; hasDot) {&#10;        // déduire format: si la dernière virgule vient après le dernier point =&gt; format EU&#10;        str = (str.lastIndexOf(',') &gt; str.lastIndexOf('.')) ? str.replace(/\./g, '').replace(/,/g, '.') : str.replace(/,/g, '');&#10;    } else if (hasComma) {&#10;        str = str.replace(/,/g, '.');&#10;    }&#10;    const n = parseFloat(str);&#10;    return Number.isFinite(n) ? n : 0;&#10;}&#10;&#10;/**&#10; * Extrait les prix (base et ancien) à partir de la page chargée avec Cheerio.&#10; * Priorité: lire le bloc Nosto caché si présent (div.notranslate &gt; span.nosto_product).&#10; * @param {*} $ - instance Cheerio&#10; * @returns {{basePrice: number|null, oldPrice: number|null}}&#10; */&#10;function extractPrices($) {&#10;    try {&#10;        // Cherche le bloc Nosto caché&#10;        const nostoBlock = $('div.notranslate').filter((i, el) =&gt; $(el).find('span.nosto_product').length &gt; 0).first();&#10;        if (nostoBlock &amp;&amp; nostoBlock.length) {&#10;            const product = nostoBlock.find('span.nosto_product').first();&#10;            const rawPrice = product.find('span.price').first().text().trim() || product.find('.price').first().text().trim();&#10;            const rawList = product.find('span.list_price').first().text().trim();&#10;            const base = parsePriceString(rawPrice);&#10;            const old = parsePriceString(rawList);&#10;            console.warn(`extractPrices: trouvé bloc Nosto -&gt; rawPrice='${rawPrice}', rawList='${rawList}', parsed base=${base}, old=${old}`);&#10;            return { basePrice: base &gt; 0 ? base : null, oldPrice: old &gt; 0 ? old : null };&#10;        }&#10;    } catch (e) {&#10;        console.warn('extractPrices: erreur lors de la lecture du bloc Nosto', e &amp;&amp; e.message ? e.message : e);&#10;    }&#10;&#10;    // Fallback: pas de prix récupéré pour ce fournisseur&#10;    console.warn('extractPrices: aucun bloc Nosto trouvé, prix non récupérés pour ce fournisseur.');&#10;    return { basePrice: null, oldPrice: null };&#10;}&#10;&#10;// --- Fin Fonctions Utilitaires ---&#10;&#10;/**&#10; * Extrait les URLs des images du produit.&#10; * @param {*} $ - l'instance Cheerio (non typée ici)&#10; * @param {string} html - Le contenu HTML brut.&#10; * @returns {string[]}&#10; */&#10;function extractImages($, html) {&#10;    const imageUrls = new Set();&#10;    const baseUrl = 'https://www.titaniumstrength.fr';&#10;&#10;    // Stratégie 1: Balises &lt;img&gt;&#10;    $('img').each((i, elem) =&gt; {&#10;        const src = $(elem).attr('src') || $(elem).attr('data-src') || $(elem).attr('data-lazy');&#10;        if (src) imageUrls.add(src);&#10;    });&#10;&#10;    // Stratégie 2: Scripts JSON (Galeries Magento)&#10;    $('script[type=&quot;text/x-magento-init&quot;], script').each((i, elem) =&gt; {&#10;        const scriptContent = $(elem).html() || '';&#10;        const regex = /&quot;(?:https?:)?\/\/[^&quot;]*\/media\/catalog\/product\/[^&quot;]*\.(?:jpg|jpeg|png|webp)&quot;/gi;&#10;        const matches = scriptContent.match(regex);&#10;        if (matches) matches.forEach(url =&gt; imageUrls.add(url.replace(/&quot;/g, '')));&#10;    });&#10;&#10;    // Stratégie 3: Regex globale sur le HTML&#10;    const regex = /https?:\/\/[^&quot;'\s]*\/media\/catalog\/product\/[^&quot;'\s]*\.(?:jpg|jpeg|png|webp)/gi;&#10;    const matches = html.match(regex);&#10;    if (matches) matches.forEach(url =&gt; imageUrls.add(url));&#10;&#10;    return [...imageUrls]&#10;        .map(url =&gt; url.startsWith('/') ? baseUrl + url : url)&#10;        .map(url =&gt; url.split('?')[0]) // Nettoyer les query params&#10;        .filter(url =&gt;&#10;            !/data:image|logo|placeholder|\.pdf|\/icon\//.test(url) &amp;&amp;&#10;            url.includes('/media/catalog/product/')&#10;        )&#10;        .slice(0, 10);&#10;}&#10;&#10;/**&#10; * Extrait la description du produit.&#10; * @param {*} $ - l'instance Cheerio&#10; * @returns {string}&#10; */&#10;function extractDescription($) {&#10;    const parts = [];&#10;    $('#description, #additional').each((i, el) =&gt; {&#10;        const html = $(el).html();&#10;        if (html) parts.push(html);&#10;    });&#10;&#10;    if (parts.length === 0) {&#10;        const fallback =&#10;            $('#nav-description').html() ||&#10;            $('.product-description').html() ||&#10;            $('[itemprop=&quot;description&quot;]').html() ||&#10;            $('meta[name=&quot;description&quot;]').attr('content');&#10;        if (fallback) parts.push(fallback);&#10;    }&#10;&#10;    return parts.map((part, index) =&gt; {&#10;        const $part = cheerio.load(part);&#10;        // retirer les liens HTML pour garder le texte propre&#10;        $part('a').each((_, el) =&gt; $part(el).replaceWith($part(el).text()));&#10;        let cleanHtml = $part.html() || '';&#10;&#10;        if (index === 0) { // Ne couper que la description principale&#10;            const stopIndex = cleanHtml.toLowerCase().search(/à propos|produits liés|associés/i);&#10;            if (stopIndex &gt; 0) cleanHtml = cleanHtml.substring(0, stopIndex);&#10;        }&#10;        return cleanHtml;&#10;    }).join('\n\n');&#10;}&#10;&#10;/**&#10; * Extrait le SKU du produit.&#10; * @param {*} $ - l'instance Cheerio&#10; * @returns {string}&#10; */&#10;function extractSku($) {&#10;    const selectors = [&#10;        '.product.attribute.sku .value',&#10;        '.product-attribute.sku .value',&#10;        '[class*=&quot;attribute sku&quot;] .value'&#10;    ];&#10;    for (const sel of selectors) {&#10;        const text = $(sel).first().text().trim();&#10;        if (text) return text;&#10;    }&#10;    const bodyText = $.text();&#10;    const skuMatch = bodyText.match(/(?:SKU|Référence|REF)\s*[:\s]*([A-Za-z0-9-_.]+)/i) ||&#10;                     bodyText.match(/\b([A-Z0-9]{1,3}-[A-Z0-9-]{3,})\b/i);&#10;    return skuMatch ? skuMatch[1].trim() : '';&#10;}&#10;&#10;// --- NOUVELLE LOGIQUE DE PRIX ---&#10;&#10;/**&#10; * Détecte si l'URL correspond à Titanium Strength&#10; */&#10;export function isTitaniumStrength(url) {&#10;    return url.includes('titaniumstrength.fr');&#10;}&#10;&#10;/**&#10; * Extrait les données d'un produit Titanium Strength&#10; * @param {object} page - Page Playwright (non utilisée, on fait du HTTP direct)&#10; * @returns {Object} - Données du produit&#10; */&#10;export async function scrapeTitaniumStrength(page) {&#10;    console.log('   ️  Scraper: Titanium Strength (HTTP + Cheerio)');&#10;    const url = page.url();&#10;    console.log(`    Récupération HTTP de: ${url}`);&#10;&#10;    try {&#10;        const response = await gotScraping.get({&#10;            url: url,&#10;            timeout: { request: 30000 },&#10;            headers: {&#10;                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36',&#10;                'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8',&#10;                'Accept-Language': 'fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7',&#10;            }&#10;        });&#10;        console.log(`   ✓ HTML récupéré: ${response.body.length} caractères`);&#10;&#10;        const $ = cheerio.load(response.body);&#10;        const html = response.body;&#10;        console.log('    Parsing des données...');&#10;&#10;        // --- Extraction des données ---&#10;        let title = $('h1.page-title').text().trim() || $('title').text().split('|')[0].trim();&#10;        const { basePrice, oldPrice } = extractPrices($); // stub -&gt; null&#10;        const sku = extractSku($);&#10;        const allImages = extractImages($, html);&#10;        let description = extractDescription($);&#10;&#10;        // Remplacements de marque&#10;        const brandRegex = /Titanium\s+Strength/gi;&#10;        title = title.replace(brandRegex, 'RAKK').replace(/Titanium/gi, 'RAKK');&#10;        description = description.replace(brandRegex, 'RAKK').replace(/Titanium/gi, 'RAKK');&#10;&#10;        console.log(`    Titre: ${title.substring(0, 50)}`);&#10;        if (basePrice == null) {&#10;            console.log('    Prix: non récupéré pour ce fournisseur');&#10;        } else {&#10;            console.log(`    Prix: ${basePrice}€${oldPrice ? ` (barré: ${oldPrice}€)` : ''}`);&#10;        }&#10;        console.log(`   ️  SKU: ${sku || 'NON TROUVÉ'}`);&#10;        console.log(`   ️  Images: ${allImages.length} trouvée(s)`);&#10;        console.log(`    Description: ${description.length} caractères`);&#10;&#10;        // --- Assemblage final ---&#10;        const productData = {&#10;            title,&#10;            description,&#10;            images: allImages,&#10;            price: basePrice,&#10;            oldPrice: oldPrice || null,&#10;            discount: null,&#10;            variants: [{&#10;                name: 'Default',&#10;                price: basePrice,&#10;                isDefault: true,&#10;                type: 'default',&#10;                sku: sku || 'TitaniumStrength-Default'&#10;            }],&#10;            variantsCount: 1,&#10;            sourceUrl: url,&#10;            supplier: 'TitaniumStrength',&#10;            metadata: {&#10;                availability: 'En stock',&#10;                oldPrice: oldPrice || null,&#10;                discount: null,&#10;                platform: 'HTTP scraping (Cheerio)',&#10;                sku&#10;            }&#10;        };&#10;&#10;        console.log('   ✅ Extraction terminée avec succès');&#10;        return productData;&#10;&#10;    } catch (error) {&#10;        console.error(`   ❌ Erreur lors du scraping HTTP: ${error.message}`);&#10;        throw error;&#10;    }&#10;}&#10;&#10;&#10;" />
              <option name="updatedContent" value="/**&#10; * Scraper spécifique pour Titanium Strength&#10; * Site: https://www.titaniumstrength.fr&#10; *&#10; * NOTE: Ce site bloque Playwright/Puppeteer, on utilise donc axios + cheerio&#10; */&#10;&#10;import { gotScraping } from 'got-scraping';&#10;import * as cheerio from 'cheerio';&#10;&#10;// --- Fonctions Utilitaires ---&#10;&#10;/**&#10; * Parse une chaîne de prix simple (ex: &quot;2355&quot; ou &quot;1 535,00€&quot;) en nombre.&#10; */&#10;function parsePriceString(s) {&#10;    if (!s &amp;&amp; s !== 0) return 0;&#10;    let str = String(s).trim();&#10;    if (!str) return 0;&#10;    // enlever espaces insécables et espaces fins&#10;    str = str.replace(/\u00A0|\u202F|\s/g, '');&#10;    // ne garder que chiffres, points, virgules et signe -&#10;    str = str.replace(/[^0-9.,-]/g, '');&#10;    if (!str) return 0;&#10;    const hasComma = str.indexOf(',') !== -1;&#10;    const hasDot = str.indexOf('.') !== -1;&#10;    if (hasComma &amp;&amp; hasDot) {&#10;        // déduire format: si la dernière virgule vient après le dernier point =&gt; format EU&#10;        str = (str.lastIndexOf(',') &gt; str.lastIndexOf('.')) ? str.replace(/\./g, '').replace(/,/g, '.') : str.replace(/,/g, '');&#10;    } else if (hasComma) {&#10;        str = str.replace(/,/g, '.');&#10;    }&#10;    const n = parseFloat(str);&#10;    return Number.isFinite(n) ? n : 0;&#10;}&#10;&#10;/**&#10; * Extrait les prix (base et ancien) à partir de la page chargée avec Cheerio.&#10; * Priorité: lire le bloc Nosto caché si présent (div.notranslate &gt; span.nosto_product).&#10; * @param {*} $ - instance Cheerio&#10; * @returns {{basePrice: number|null, oldPrice: number|null}}&#10; */&#10;function extractPrices($) {&#10;    try {&#10;        // Cherche le bloc Nosto caché&#10;        const nostoBlock = $('div.notranslate').filter((i, el) =&gt; $(el).find('span.nosto_product').length &gt; 0).first();&#10;        if (nostoBlock &amp;&amp; nostoBlock.length) {&#10;            const product = nostoBlock.find('span.nosto_product').first();&#10;            const rawPrice = product.find('span.price').first().text().trim() || product.find('.price').first().text().trim();&#10;            const rawList = product.find('span.list_price').first().text().trim();&#10;            const base = parsePriceString(rawPrice);&#10;            const old = parsePriceString(rawList);&#10;            console.warn(`extractPrices: trouvé bloc Nosto -&gt; rawPrice='${rawPrice}', rawList='${rawList}', parsed base=${base}, old=${old}`);&#10;            return { basePrice: base &gt; 0 ? base : null, oldPrice: old &gt; 0 ? old : null };&#10;        }&#10;    } catch (e) {&#10;        console.warn('extractPrices: erreur lors de la lecture du bloc Nosto', e &amp;&amp; e.message ? e.message : e);&#10;    }&#10;&#10;    // Fallback: pas de prix récupéré pour ce fournisseur&#10;    console.warn('extractPrices: aucun bloc Nosto trouvé, prix non récupérés pour ce fournisseur.');&#10;    return { basePrice: null, oldPrice: null };&#10;}&#10;&#10;// --- Fin Fonctions Utilitaires ---&#10;&#10;/**&#10; * Extrait les URLs des images du produit.&#10; * @param {*} $ - l'instance Cheerio (non typée ici)&#10; * @param {string} html - Le contenu HTML brut.&#10; * @returns {string[]}&#10; */&#10;function extractImages($, html) {&#10;    const imageUrls = new Set();&#10;    const baseUrl = 'https://www.titaniumstrength.fr';&#10;&#10;    // Stratégie 1: Balises &lt;img&gt;&#10;    $('img').each((i, elem) =&gt; {&#10;        const src = $(elem).attr('src') || $(elem).attr('data-src') || $(elem).attr('data-lazy');&#10;        if (src) imageUrls.add(src);&#10;    });&#10;&#10;    // Stratégie 2: Scripts JSON (Galeries Magento)&#10;    $('script[type=&quot;text/x-magento-init&quot;], script').each((i, elem) =&gt; {&#10;        const scriptContent = $(elem).html() || '';&#10;        const regex = /&quot;(?:https?:)?\/\/[^&quot;]*\/media\/catalog\/product\/[^&quot;]*\.(?:jpg|jpeg|png|webp)&quot;/gi;&#10;        const matches = scriptContent.match(regex);&#10;        if (matches) matches.forEach(url =&gt; imageUrls.add(url.replace(/&quot;/g, '')));&#10;    });&#10;&#10;    // Stratégie 3: Regex globale sur le HTML&#10;    const regex = /https?:\/\/[^&quot;'\s]*\/media\/catalog\/product\/[^&quot;'\s]*\.(?:jpg|jpeg|png|webp)/gi;&#10;    const matches = html.match(regex);&#10;    if (matches) matches.forEach(url =&gt; imageUrls.add(url));&#10;&#10;    return [...imageUrls]&#10;        .map(url =&gt; url.startsWith('/') ? baseUrl + url : url)&#10;        .map(url =&gt; url.split('?')[0]) // Nettoyer les query params&#10;        .filter(url =&gt;&#10;            !/data:image|logo|placeholder|\.pdf|\/icon\//.test(url) &amp;&amp;&#10;            url.includes('/media/catalog/product/')&#10;        )&#10;        .slice(0, 10);&#10;}&#10;&#10;/**&#10; * Extrait la description du produit.&#10; * @param {*} $ - l'instance Cheerio&#10; * @returns {string}&#10; */&#10;function extractDescription($) {&#10;    const parts = [];&#10;    $('#description, #additional').each((i, el) =&gt; {&#10;        const html = $(el).html();&#10;        if (html) parts.push(html);&#10;    });&#10;&#10;    if (parts.length === 0) {&#10;        const fallback =&#10;            $('#nav-description').html() ||&#10;            $('.product-description').html() ||&#10;            $('[itemprop=&quot;description&quot;]').html() ||&#10;            $('meta[name=&quot;description&quot;]').attr('content');&#10;        if (fallback) parts.push(fallback);&#10;    }&#10;&#10;    return parts.map((part, index) =&gt; {&#10;        const $part = cheerio.load(part);&#10;        // retirer les liens HTML pour garder le texte propre&#10;        $part('a').each((_, el) =&gt; $part(el).replaceWith($part(el).text()));&#10;        let cleanHtml = $part.html() || '';&#10;&#10;        if (index === 0) { // Ne couper que la description principale&#10;            const stopIndex = cleanHtml.toLowerCase().search(/à propos|produits liés|associés/i);&#10;            if (stopIndex &gt; 0) cleanHtml = cleanHtml.substring(0, stopIndex);&#10;        }&#10;        return cleanHtml;&#10;    }).join('\n\n');&#10;}&#10;&#10;/**&#10; * Extrait le SKU du produit.&#10; * @param {*} $ - l'instance Cheerio&#10; * @returns {string}&#10; */&#10;function extractSku($) {&#10;    const selectors = [&#10;        '.product.attribute.sku .value',&#10;        '.product-attribute.sku .value',&#10;        '[class*=&quot;attribute sku&quot;] .value'&#10;    ];&#10;    for (const sel of selectors) {&#10;        const text = $(sel).first().text().trim();&#10;        if (text) return text;&#10;    }&#10;    const bodyText = $.text();&#10;    const skuMatch = bodyText.match(/(?:SKU|Référence|REF)\s*[:\s]*([A-Za-z0-9-_.]+)/i) ||&#10;                     bodyText.match(/\b([A-Z0-9]{1,3}-[A-Z0-9-]{3,})\b/i);&#10;    return skuMatch ? skuMatch[1].trim() : '';&#10;}&#10;&#10;/**&#10; * Extrait le contenu du bloc &quot;product attribute overview&quot; (et variantes de classes)&#10; * Retourne du HTML (paragraphes) ou une chaîne vide&#10; * @param {*} $ - Cheerio&#10; * @returns {string}&#10; */&#10;function extractAttributesOverview($) {&#10;    // Sélecteurs explicites courants&#10;    const selectors = [&#10;        '.product-attribute-overview',&#10;        '.product-attributes-overview',&#10;        '.product.attribute.overview',&#10;        '.additional-attributes',&#10;        '#product-attribute-specs-table',&#10;    ];&#10;&#10;    let found = null;&#10;    for (const sel of selectors) {&#10;        try {&#10;            const el = $(sel).first();&#10;            if (el &amp;&amp; el.length) { found = el; break; }&#10;        } catch (e) { /* noop */ }&#10;    }&#10;&#10;    // Fallback: chercher un élément dont la class contient les tokens product, attribute, overview&#10;    if (!found) {&#10;        found = $('*[class]').filter((i, el) =&gt; {&#10;            const cls = ($(el).attr('class') || '').toLowerCase().trim();&#10;            if (!cls) return false;&#10;            const parts = cls.split(/\s+/);&#10;            return parts.includes('product') &amp;&amp; parts.includes('attribute') &amp;&amp; parts.includes('overview');&#10;        }).first();&#10;    }&#10;&#10;    if (!found || !found.length) return '';&#10;&#10;    // Extraire paragraphes si présents&#10;    const paragraphs = [];&#10;    found.find('p').each((i, p) =&gt; {&#10;        const txt = $(p).text().trim();&#10;        if (txt) paragraphs.push(txt);&#10;    });&#10;&#10;    // Si pas de &lt;p&gt;, prendre le texte direct mais le fractionner proprement&#10;    if (paragraphs.length === 0) {&#10;        const text = found.text().trim();&#10;        if (text) {&#10;            const lines = text.split(/\r?\n/).map(l =&gt; l.trim()).filter(Boolean);&#10;            lines.forEach(line =&gt; {&#10;                // ignorer le titre générique s'il existe&#10;                if (/product attribute overview/i.test(line)) return;&#10;                paragraphs.push(line);&#10;            });&#10;        }&#10;    }&#10;&#10;    if (paragraphs.length === 0) return '';&#10;&#10;    // Construire HTML et retirer l'élément du DOM pour éviter duplication&#10;    const html = paragraphs.map(p =&gt; `&lt;p&gt;${p}&lt;/p&gt;`).join('\n');&#10;    try { found.remove(); } catch (e) { /* noop */ }&#10;&#10;    return `&lt;div class=&quot;product-attributes-overview&quot;&gt;\n${html}\n&lt;/div&gt;`;&#10;}&#10;&#10;// --- NOUVELLE LOGIQUE DE PRIX ---&#10;&#10;/**&#10; * Détecte si l'URL correspond à Titanium Strength&#10; */&#10;export function isTitaniumStrength(url) {&#10;    return url.includes('titaniumstrength.fr');&#10;}&#10;&#10;/**&#10; * Extrait les données d'un produit Titanium Strength&#10; * @param {object} page - Page Playwright (non utilisée, on fait du HTTP direct)&#10; * @returns {Object} - Données du produit&#10; */&#10;export async function scrapeTitaniumStrength(page) {&#10;    console.log('   ️  Scraper: Titanium Strength (HTTP + Cheerio)');&#10;    const url = page.url();&#10;    console.log(`    Récupération HTTP de: ${url}`);&#10;&#10;    try {&#10;        const response = await gotScraping.get({&#10;            url: url,&#10;            timeout: { request: 30000 },&#10;            headers: {&#10;                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36',&#10;                'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8',&#10;                'Accept-Language': 'fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7',&#10;            }&#10;        });&#10;        console.log(`   ✓ HTML récupéré: ${response.body.length} caractères`);&#10;&#10;        const $ = cheerio.load(response.body);&#10;        const html = response.body;&#10;        console.log('    Parsing des données...');&#10;&#10;        // --- Extraction des données ---&#10;        let title = $('h1.page-title').text().trim() || $('title').text().split('|')[0].trim();&#10;        const { basePrice, oldPrice } = extractPrices($);&#10;        const sku = extractSku($);&#10;        const allImages = extractImages($, html);&#10;&#10;        // Extraire et préfixer le bloc &quot;product attribute overview&quot;&#10;        const attributesOverview = extractAttributesOverview($);&#10;&#10;        let description = extractDescription($);&#10;        if (attributesOverview &amp;&amp; attributesOverview.length) {&#10;            description = attributesOverview + '\n\n' + description;&#10;        }&#10;&#10;        // Remplacements de marque&#10;        const brandRegex = /Titanium\s+Strength/gi;&#10;        title = title.replace(brandRegex, 'RAKK').replace(/Titanium/gi, 'RAKK');&#10;        description = description.replace(brandRegex, 'RAKK').replace(/Titanium/gi, 'RAKK');&#10;&#10;        console.log(`    Titre: ${title.substring(0, 50)}`);&#10;        if (basePrice == null) {&#10;            console.log('    Prix: non récupéré pour ce fournisseur');&#10;        } else {&#10;            console.log(`    Prix: ${basePrice}€${oldPrice ? ` (barré: ${oldPrice}€)` : ''}`);&#10;        }&#10;        console.log(`   ️  SKU: ${sku || 'NON TROUVÉ'}`);&#10;        console.log(`   ️  Images: ${allImages.length} trouvée(s)`);&#10;        console.log(`    Description: ${description.substring(0, 120)}`);&#10;&#10;        // --- Assemblage final ---&#10;        const productData = {&#10;            title,&#10;            description,&#10;            images: allImages,&#10;            price: basePrice,&#10;            oldPrice: oldPrice || null,&#10;            discount: null,&#10;            variants: [{&#10;                name: 'Default',&#10;                price: basePrice,&#10;                isDefault: true,&#10;                type: 'default',&#10;                sku: sku || 'TitaniumStrength-Default'&#10;            }],&#10;            variantsCount: 1,&#10;            sourceUrl: url,&#10;            supplier: 'TitaniumStrength',&#10;            metadata: {&#10;                availability: 'En stock',&#10;                oldPrice: oldPrice || null,&#10;                discount: null,&#10;                platform: 'HTTP scraping (Cheerio)',&#10;                sku&#10;            }&#10;        };&#10;&#10;        console.log('   ✅ Extraction terminée avec succès');&#10;        return productData;&#10;&#10;    } catch (error) {&#10;        console.error(`   ❌ Erreur lors du scraping HTTP: ${error.message}`);&#10;        throw error;&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>